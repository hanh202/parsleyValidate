'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _log = require('./log');

var _log2 = _interopRequireDefault(_log);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Format date into readable time for humans.
 *
 * @param {Date} time
 * @returns {String}
 */
function format(time) {
  return time.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/, '$1');
}

/**
 * Run a given task when monitoring execution time.
 *
 * @param {Function} fn
 * @param {Object} opts
 * @returns {Promise.<TResult>}
 */
function run(fn) {
  var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  var task = typeof fn.default === 'undefined' ? fn : fn.default;
  var start = new Date();

  _log2.default.info('[' + format(start) + '] Starting \'' + task.name + '\'...');

  return task(opts).then(function (resolution) {
    var end = new Date();
    var time = end.getTime() - start.getTime();

    _log2.default.info('[' + format(end) + '] Finished \'' + task.name + '\' after ' + time + ' ms.');

    return resolution;
  });
}

exports.default = run;